# üõ°Ô∏è Wazuh + Sysmon SIEM Lab ‚Äì Windows Endpoint Monitoring

This project documents the complete deployment of Wazuh 4.11.2 on Ubuntu 22.04 and the integration of Sysmon on a Windows 11 virtual machine. The lab demonstrates the centralized monitoring of Windows endpoint behavior using custom rules in Wazuh to detect specific Sysmon events.

## üéØ Objectives

Install and configure Wazuh (Manager, Indexer, Dashboard) on Ubuntu VM

Deploy the Wazuh agent on a Windows 11 virtual machine

Install Sysmon with a custom configuration on the endpoint

Monitor Sysmon events centrally via Wazuh

Create custom detection rules from the Wazuh dashboard

## üß™ Environment

| Component       | Details                                  |
|-----------------|------------------------------------------|
| Host OS         | Windows 11 (with VirtualBox)             |
| Ubuntu VM       | Ubuntu 22.04 LTS (Wazuh Manager)         |
| Windows VM      | Windows 11 Home (Sysmon + Wazuh agent)   |
| Hypervisor      | VirtualBox                               |
| Networking Mode | Bridged Adapter                          |

## üì∏ Setup Walkthrough

### 1. Virtual Machine Environment

Launching Ubuntu (for the Wazuh manager) and a Windows 11 VM (as monitored endpoint) in VirtualBox.

![VMs](images/1.VM_Used.png)

### 2. Ubuntu Update and Upgrade

Initial preparation with sudo apt update && sudo apt upgrade.

![VMs](images/2.Preparing_the_Environment.png)

### 3. Downloading the Wazuh Installer Script

We use curl to fetch the official installer script.

![VMs](images/3.Downloading_Wazuh.png)

### 4. Granting Execution Rights

The script is made executable.

![VMs](images/4.Changing_Permissions.png)

### 5. Installing the Wazuh Stack

We run the script using the -a all-in-one flag.

![VMs](images/5.Installing_Wazuh.png)

### 6. Web Interface Credentials

Installer provides credentials for the Wazuh Dashboard.

![VMs](images/6.Getting_Dashboard_credentials.png)

### 7. Logging into Wazuh Dashboard

Accessing the interface at https://<manager-ip>:443.

![VMs](images/7.Testing_Dashboard.png)

### 8. Deploying a New Agent

We create an agent entry for the Windows VM from the dashboard.

![VMs](images/8.Deploying_New_Agent.png)

### 9. Installing Wazuh Agent on Windows

Commands generated by Wazuh are executed in PowerShell.

![VMs](images/9.Configuring_Agent.png)

### 10. Starting the Agent Service

We confirm the service is running.

![VMs](images/10.Starting_Wazuh_Agent.png)

### 11. Confirming Agent Connection

Wazuh shows the new Windows endpoint as connected.

![VMs](images/11.Downloading_Sysmon.png)

### 12. Installing Sysmon

We use PowerShell to download Sysmon.

![VMs](images/12.Extracting_Sysmon.png)

### 13. Extracting Sysmon Package

Unzipping and viewing the Sysmon executables.

![VMs](images/13.Downloading_Sysmon_Conf.png)

### 14. Downloading Sysmon Configuration

We fetch the SwiftOnSecurity config.

![VMs](images/14.Starting_Sysmon.png)

### 15. Installing Sysmon with Configuration

Sysmon is launched with the custom configuration.

![VMs](images/15.Verifing_Sysmon.png)

### 16. Verifying Logs in Event Viewer

Sysmon events appear under the Operational channel.

![VMs](images/16.Veryfing_Manager-Agent_Connection.png)

### 17. Checking the Wazuh Dashboard

Sysmon events are now ingested into the Wazuh platform.

![VMs](images/17.Opening_Wazuh_Conf.png)

### 18. Enabling Vulnerability Detection

Uncommenting and configuring detection in ossec.conf.

![VMs](images/18.Enabling_Vulnerability_Detection.png)

### 19. Restarting the Wazuh Manager

Apply configuration changes with a restart.

![VMs](images/19.Restarting_Wazuh.png)

### 20. Verifying Vulnerability Scan Results

We now see compliance data in the dashboard.

![VMs](images/20.Checking_Vulnerability_Detection.png)

## üîç Creating and Testing Custom Rule

### 21. Navigating to Rule Management

Accessing the Wazuh dashboard to manage detection rules.

![VMs](images/21.Going_To_Rules.png)

### 22. Adding a New Rule

Clicking on "Add new rules file" and selecting "Custom rules".

![VMs](images/22.Clicking_On_New_Rule.png)

### 23. Writing the Rule

We define a rule to detect PowerShell execution based on Sysmon Event ID 1.

<group name="custom-windows-rules">
  <rule id="100100" level="10">
    <if_sid>61603</if_sid>
    <field name="win.eventdata.image">powershell.exe</field>
    <description>Uso di PowerShell rilevato da Sysmon</description>
  </rule>
</group>

![VMs](images/23.Creating_And_Naming_The_rule.png)

### 24. Triggering the Rule

We execute a PowerShell command to simulate malicious behavior.

![VMs](images/24.Trying_To_Trigger_The_Alert.png)

### 25. Searching for the Alert

We filter events in the Wazuh dashboard by rule ID.

![VMs](images/25.FIltering_Alerts.png)

### 26. Confirming Alert is Logged

The rule successfully triggered an alert.

![VMs](images/26.Alert_Found.png)

‚úÖ Final Outcome

‚úÖ Wazuh Stack installed on Ubuntu

‚úÖ Windows 11 endpoint enrolled and monitored

‚úÖ Sysmon events are parsed and forwarded to Wazuh

‚úÖ Custom detection rule for PowerShell execution tested successfully

üë§ Author

Created for the TryHackMe SOC Level 1 path as a demonstration of centralized endpoint monitoring using open-source tools.

Feel free to fork, adapt, and improve.
